# JAMES 企業別設定とマルチモード運用の提案

## 1. 課題認識

現在のJAMESプロトタイプは「J-Maruei」向けに固定的に実装されている。実際の導入を進めるにあたり、以下の2つの課題がある。

**課題A: 企業別カスタマイズ**
システム名称、ロゴ、カラー、用語などを導入企業ごとに変更できる仕組みが必要。

**課題B: DCSなし運用への対応**
DCS（AI改廃提案）は全企業が導入するわけではない。バイヤー自身の判断で棚割変更・カット・導入を行う「マニュアルモード」が必要。

---

## 2. 企業別設定（テナント設定）

### 2.1 設定項目一覧

| カテゴリ | 設定項目 | 例（J-Maruei） | 例（他社A） |
|---------|---------|---------------|------------|
| **ブランド** | システム名称 | JAMES | SHELF-NAVI |
| | サブタイトル | J-Maruei AI Merchandising Enhancement System | 棚割管理・自動発注システム |
| | ロゴ画像 | JAMES ロゴ | 自社ロゴ |
| | プライマリカラー | #0891B2（シアン） | #E11D48（赤） |
| | ダークカラー | #0F172A | #1C1917 |
| **機能トグル** | DCS機能 | ON | OFF |
| | AI発注提案 | ON | OFF |
| | 収益分析パネル | ON | ON |
| | JSONエクスポート | ON | OFF（セキュリティ） |
| | 商品マスタ検索 | API連携 | ローカルCSV |
| **用語** | 棚割変更 | DCS提案 | 改廃指示 |
| | 商品カット | カット | 撤去 |
| | フェース変更 | フェース増/減 | 陳列数変更 |
| | 発注確定 | 発注確定 | 補充オーダー |
| **データ連携** | 棚割マスタ | 棚POWER連携 | ストアマネジャー |
| | 商品マスタ | 基幹API | CSVインポート |
| | POS実績 | リアルタイムAPI | 日次バッチ |
| | 在庫データ | ハンディ端末連携 | 基幹システム |
| **権限** | 店舗担当者 | 閲覧・発注のみ | 閲覧・発注のみ |
| | カテゴリ担当 | 棚割編集可 | 棚割編集可 |
| | バイヤー | 全権限 | 全権限 |
| | システム管理者 | 設定変更可 | 設定変更可 |

### 2.2 設定の実装方式

```
/config/
  tenant.json          ← 企業別設定ファイル（ビルド時注入 or API取得）
  terms.json           ← 用語マッピング
  features.json        ← 機能ON/OFF
```

**tenant.json の例:**
```json
{
  "tenantId": "j-maruei",
  "brand": {
    "name": "JAMES",
    "subtitle": "J-Maruei AI Merchandising Enhancement System",
    "logo": "/assets/james-logo.svg",
    "colors": {
      "primary": "#0891B2",
      "dark": "#0F172A",
      "accent": "#06B6D4",
      "background": "#F8FAFC"
    }
  },
  "features": {
    "dcs": true,
    "aiOrderSuggestion": true,
    "profitPanel": true,
    "jsonExport": true,
    "productMasterApi": true
  },
  "terms": {
    "cut": "カット",
    "faceChange": "フェース変更",
    "orderConfirm": "発注確定",
    "shelfEdit": "棚割編集"
  },
  "roles": {
    "store": ["view", "order"],
    "category": ["view", "order", "shelfEdit"],
    "buyer": ["view", "order", "shelfEdit", "dcs", "approve", "settings"]
  }
}
```

### 2.3 Reactでの実装イメージ

```jsx
// ConfigContext で全コンポーネントに設定を配信
const ConfigContext = createContext(DEFAULT_CONFIG);

function App() {
  const [config, setConfig] = useState(null);

  useEffect(() => {
    // テナント設定をロード（API or ローカルファイル）
    loadTenantConfig().then(setConfig);
  }, []);

  return (
    <ConfigContext.Provider value={config}>
      <Router />
    </ConfigContext.Provider>
  );
}

// 各コンポーネントで使用
function PortalScreen() {
  const { brand, features, terms } = useContext(ConfigContext);

  return (
    <div style={{ background: brand.colors.background }}>
      <h1 style={{ color: brand.colors.primary }}>{brand.name}</h1>
      {features.dcs && <DcsSummaryCard />}
      {/* ... */}
    </div>
  );
}
```

---

## 3. 非DCSモード：バイヤー主導の棚割運用

### 3.1 DCSモードと非DCSモードの比較

| 項目 | DCSモード（AI主導） | 非DCSモード（バイヤー主導） |
|------|-------------------|--------------------------|
| **改廃の起点** | AIがPI値・ライフサイクルを分析して提案 | バイヤーが市場動向・商談・季節で判断 |
| **カットの判断** | AI: PI値低下→カット提案→承認/却下 | バイヤー: 編集モードで直接カット |
| **新商品導入** | AI: 空きスペース最適化→導入候補提示 | バイヤー: 商品マスタから検索→追加 |
| **フェース変更** | AI: 販売実績→最適フェース計算→提案 | バイヤー: ±ボタンで手動調整 |
| **承認フロー** | AI提案→バイヤー承認→店舗実行 | バイヤー編集→（上長承認）→店舗実行 |
| **ワークフロー** | DCS一覧→一括承認→差分確認 | カテゴリレビュー→個別編集→保存 |

### 3.2 非DCSモードのワークフロー

#### フロー1: 定期カテゴリレビュー（月次/四半期）

```
① ポータル → カテゴリ選択
    └ カテゴリ一覧に「前回レビュー日」「次回レビュー予定」を表示

② 棚割画面を開く
    └ 自動で以下を表示:
      - 直近13週の販売トレンド（↑↓→の矢印表示）
      - PI値のカテゴリ平均との比較
      - 在庫回転率の警告（遅い商品にアラート）

③ バイヤーが判断
    └ カット候補: ランクC + 売上下降 + 在庫過多の商品をハイライト
    └ フェース増候補: ランクA + 売上上昇の商品をハイライト
    └ 導入検討: 「＋追加」ボタンから新商品マスタを検索

④ 編集モードで実行
    └ 商品カット（×ボタン or スワイプ削除）
    └ フェース調整（±ボタン）
    └ 新商品追加（商品マスタダイアログ）
    └ 並び替え（ドラッグ&ドロップ）

⑤ 変更サマリー確認
    └ 変更前 vs 変更後の比較画面
    └ 「カット: 3品、追加: 2品、F変更: 5品」の要約
    └ 棚効率の変化（売上/m → 変更後の推定）

⑥ 保存 & 配信
    └ 保存（ローカル or サーバー）
    └ 店舗への棚割指示書出力（PDF/印刷）
    └ 実施日の設定
```

#### フロー2: 商品入替（新商品導入）

```
① 新商品情報入手（商談・展示会・本部指示）

② ポータル → 対象カテゴリを選択

③ 棚割画面で空きスペース確認
    └ 各段の「空きmm」を視覚的に確認
    └ 空きが不足 → カット候補を自動サジェスト
      （PI値・売上ランク・在庫回転の低い順に表示）

④ カット実行 → スペース確保

⑤ 新商品追加
    └ 商品マスタから検索 or JAN手入力
    └ 物理寸法（幅・高・奥行）を自動取得
    └ 初期フェース数を設定
    └ 棚位置（段・並び順）を指定

⑥ 初期パラメータ設定
    └ 発注点（OP）
    └ 在庫日数
    └ リードタイム
    └ ※ 類似商品のパラメータを参考値として表示

⑦ 保存 & 店舗配信
```

#### フロー3: 緊急対応（欠品・リコール・季節入替）

```
① 緊急カット or 一時撤去
    └ 該当商品を素早く検索
    └ 「一時撤去」「完全カット」の選択肢
    └ 一時撤去 = 棚からは外すが復元可能リストに残す

② スペース活用
    └ 既存商品のフェース拡大
    └ or 代替商品の緊急導入
    └ 「空きスペース放置」も選択可能（棚札のみ対応）

③ 即時配信
    └ 対象店舗に即時通知
    └ 実施確認の受領管理
```

### 3.3 非DCSモードで追加すべき画面・機能

| 機能 | 説明 | 優先度 |
|------|------|--------|
| **変更サマリー画面** | 編集前後の差分表示。カット/追加/F変更の一覧と棚効率の変化 | 高 |
| **カット候補サジェスト** | PI値・売上ランク・在庫回転が低い商品を自動ハイライト（AIではなくルールベース） | 高 |
| **棚割指示書出力** | 変更内容をPDF/印刷用に整形。店舗への指示書フォーマット | 高 |
| **カテゴリレビュー管理** | レビューサイクル管理。前回/次回レビュー日、レビュー担当者 | 中 |
| **変更履歴** | 誰が・いつ・何を変更したかの監査ログ | 中 |
| **商品マスタ拡張検索** | JAN、商品名、メーカー、カテゴリ横断検索。物理寸法付き | 中 |
| **類似商品パラメータ参照** | 新商品追加時に、同カテゴリ・同サイズの商品パラメータを参考表示 | 低 |
| **店舗実施確認** | 棚割変更の実施完了を店舗から報告する仕組み | 低 |

### 3.4 ポータル画面の変化

**DCSモード（現在）:**
```
┌─────────────────────────────────┐
│  JAMES                          │
│                                 │
│  [DCS提案]  [通常発注]          │
│  カット 3件   棚割管理           │
│  F変更 4件                       │
│                                 │
│  [棚割管理]  [入替提案]          │
└─────────────────────────────────┘
```

**非DCSモード:**
```
┌─────────────────────────────────┐
│  SHELF-NAVI（企業名）            │
│                                 │
│  [棚割編集]      [通常発注]      │
│  レビュー対象      全カテゴリ     │
│  5カテゴリ                       │
│                                 │
│  [変更履歴]      [指示書一覧]    │
│  今月 12件        未配信 3件     │
│                                 │
│  [カテゴリ分析]  [パラメータ]    │
└─────────────────────────────────┘
```

---

## 4. ハイブリッドモード（推奨）

多くの企業では、DCSの段階的導入が現実的。以下のハイブリッドアプローチを推奨する。

### Phase 1: マニュアルモード
- バイヤー主導の棚割編集
- ルールベースのカット候補サジェスト（PI値閾値等）
- 基本的な棚効率レポート

### Phase 2: アシストモード
- AIがカット候補・フェース最適化を「参考情報」として表示
- バイヤーは参考にするが、最終判断は自分で行う
- AI提案の採用率をトラッキング

### Phase 3: DCSモード（フル）
- AIが改廃提案を生成し、承認フローで運用
- バイヤーは承認/却下/修正の判断に集中
- 自動発注パラメータの最適化もAIが提案

### 設定による切り替え

```json
{
  "operationMode": "manual" | "assist" | "dcs",
  "assistFeatures": {
    "cutSuggestion": true,     // カット候補のハイライト
    "faceSuggestion": false,   // フェース最適化提案
    "orderOptimize": false,    // 発注パラメータ最適化
    "trendAlert": true         // 売上トレンドアラート
  }
}
```

---

## 5. 実装ロードマップ

| フェーズ | 内容 | 期間目安 |
|---------|------|---------|
| **v1.0** | テナント設定の基盤実装（ConfigContext） | 1週間 |
| **v1.1** | 非DCSポータル画面、変更サマリー画面 | 1週間 |
| **v1.2** | ルールベースのカット候補サジェスト | 3日 |
| **v1.3** | 棚割指示書PDF出力 | 3日 |
| **v2.0** | アシストモード（参考情報表示） | 2週間 |
| **v2.1** | カテゴリレビュー管理 | 1週間 |
| **v3.0** | DCSフルモード（現在のプロトタイプを正式化） | 2週間 |

---

## 6. まとめ

JAMESを汎用的な棚割管理プラットフォームとするために、以下を提案する。

1. **テナント設定**: 企業名、カラー、用語、機能ON/OFFをJSON設定ファイルで管理。ConfigContextで全画面に配信。
2. **3段階の運用モード**: マニュアル→アシスト→DCSの段階的導入パス。企業の成熟度に応じて選択可能。
3. **非DCSモードの充実**: バイヤーが自分の判断で棚割を編集する実用的なワークフロー。変更サマリー、カット候補サジェスト、指示書出力が核。
4. **ハイブリッドアプローチ**: AI活用度を設定で柔軟に制御。導入障壁を下げつつ、将来のAI化への布石を打つ。
